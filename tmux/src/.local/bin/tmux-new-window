#!/usr/bin/env sh

if ! which fzf >/dev/null 2>&1; then
    exit
fi

dir=$(
    {
        echo "${PWD}"
        echo ~/repos
        find ~/repos/ -type d -name .git -exec dirname '{}' ';' 2>/dev/null
    } | fzf
)
venv_script=$(
    cat - <<'EOF'
        if [ -f poetry.lock ]; then
            . "$(poetry env info -p)/bin/activate"
        elif [ -f ./.venv/bin/activate ]; then
            . "./.venv/bin/activate"
        elif [ -f ./venv/bin/activate ]; then
            . "./venv/bin/activate"
        fi
EOF
)

tmux rename-window "$(basename "${dir}")"
tmux send-keys "cd '${dir}' && ${venv_script} && clear" Enter
